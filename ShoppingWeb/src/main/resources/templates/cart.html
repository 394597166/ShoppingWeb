<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>cart</title>
<link rel="stylesheet" type="text/css" href="../static/css/style.css" />
<link rel="stylesheet" type="text/css" href="../static/css/shopping-mall-index.css" />
<script type="text/javascript" src="../static/js/jquery.js"></script>
<script type="text/javascript" src="../static/js/zhonglin.js"></script>
</head>

<body style="position:relative;">

<!--top 开始-->
<div class="top">
    <div class="top-con w1200">
        <p class="t-con-l f-l">您好，欢迎来到宅客微购</p>
        <ul class="t-con-r f-r">
            <li><a href="http://localhost:8080/user/personalCenter.html">我 (个人中心)</a></li>
            <li><a href="http://localhost:8080/cart/cart.html">我的购物车</a></li>
            <li><a href="http://localhost:8080/order/order.html">我的订单</a></li>
            <li class="erweima">
                <a href="#">扫描二维码</a>
                <div class="ewm-tu">
                    <a href="#"><img src="../static/images/erweima-tu.jpg" /></a>
                </div>
            </li>
            <li><a href="http://localhost:8080/user/logout">退出</a></li>
            <div style="clear:both;"></div>
        </ul>
        <div style="clear:both;"></div>
    </div>
</div>

<!--logo search 开始-->
<div class="hd-info1 w1200">
    <div class="logo f-l">
        <h1><a href="http://localhost:8080/index.html" title="宅客微购"><img src="../static/images/logo.jpg" /></a></h1>
    </div>
    <div class="dianji f-r">
        <div class="btn1">
            <a href="http://localhost:8080/user/register.html"><button class="btn1-l">注册</button></a>
            <a href="http://localhost:8080/user/login.html"><button class="btn1-r">登录</button></a>
            <div style="clear:both;"></div>
        </div>
        <a href="http://localhost:8080/admin/adminlogin.html"><button class="btn2">商家入口    ></button></a>
    </div>
    <div class="search f-r">
        <ul class="sp">
            <li class="current" ss-search="sp"><a href="JavaScript:;">商品</a></li>
            <div style="clear:both;"></div>
        </ul>
        <div class="srh">
            <div class="ipt f-l">
                <input id="goodsName" type="text" placeholder="搜索商品..." ss-search-show="sp" />
            </div>
            <button id="selectGoods" class="f-r">搜 索</button>
            <div style="clear:both;"></div>
        </div>
    </div>
    <div style="clear:both;"></div>
</div>
    

    <!--内容开始-->
    <div class="cart-content w1200">
    	<ul class="cart-tit-nav">
            <div style="clear:both;"></div>
        </ul>
        <div class="cart-con-tit">
        	<p class="p1">
				<a href="#" class="quanxuan">全选</a>
                &nbsp&nbsp
                <a href="#" class="quanbuxuan">全不选</a>
            </p>
            <p class="p2">商品信息</p>
            <p class="p3">规格</p>
            <p class="p4">数量</p>
            <p class="p5">单价（元）</p>
            <p class="p6">金额（元）</p>
            <p class="p7">操作</p>
        </div>
        <div id="nav">

        </div>
       	<div class="cart-con-footer">
			<a href="#" class="quanxuan">全选</a>
            &nbsp&nbsp
            <a href="#" class="quanbuxuan">全不选</a>
            <a href="#" id="deleteCart">删除</a>
            <a href="#" id="insertGoodscollectAll">加入收藏夹</a>
            <a href="#" id="confirmorder" style="float: right;margin-right: 20px;">生成订单</a>
        </div>
    </div>

<!--底部服务-->
<div class="ft-service">
    <div class="w1200">
        <div class="sv-con-l2 f-l">
            <dl>
                <dt><a>新手上路</a></dt>
                <dd>
                    <a href="http://localhost:8080/other/service.html">服务协议</a>
                    <a href="http://localhost:8080/other/onlinePayment.html">在线支付</a>
                </dd>
            </dl>
            <dl>
                <dt><a>配送方式</a></dt>
                <dd>
                    <a href="http://localhost:8080/other/distribution.html">配送费标准</a>
                </dd>
            </dl>
            <dl>
                <dt><a>购物指南</a></dt>
                <dd>
                    <a href="http://localhost:8080/other/FAQ.html">购物常见问题</a>
                    <a href="http://localhost:8080/other/shoppingProcess.html">购物流程</a>
                </dd>
            </dl>
            <dl>
                <dt><a>售后服务</a></dt>
                <dd>
                    <a href="http://localhost:8080/other/exchanged.html">退换货政策总则</a>
                    <a href="http://localhost:8080/other/exchanged2.html">自营商品退换货细则</a>
                </dd>
            </dl>
            <dl>
                <dt><a>关于我们</a></dt>
                <dd>
                    <a href="http://localhost:8080/other/about.html">关于我们</a>
                </dd>
            </dl>
            <div style="clear:both;"></div>
        </div>
        <div class="sv-con-r2 f-r">
            <p class="sv-r-tle">151-6264-6839</p>
            <p>周一至周五9:00-16:00</p>
            <p>（仅收市话费）</p>
            <a href="http://wpa.qq.com/msgrd?v=3&uin=394597166&site=qq&menu=yes" target="_blank" class="zxkf">24小时在线客服</a>
        </div>
        <div style="clear:both;"></div>
    </div>
</div>
<script type="text/javascript">
    $(function () {
        var $quanxuan = $(".quanxuan");
        var $quanbuxuan = $(".quanbuxuan");
        //全选事件
        $quanxuan.on("click",function () {
            $(".mid-ipt").prop("checked",true)
        });
        //全不选事件
        $quanbuxuan.on("click",function () {
            $(".mid-ipt").prop("checked",false);
        });
        var $nav = $("#nav");
        //获得所有的购物车数据
        $.ajax({
            url: "http://localhost:8080/cart/selectCartAll",
            method: "POST",
            dataType: "json",
            success: function (result) {
                if (result.result) {
                    //登录状态
                    if (result.user){
                        $.each(result.cartList,function (index,value) {
                            var $div1 = $("<div class='cart-con-info'></div>");
                            var $div2 = $("<div class='info-mid'></div>");
                            var $input1 = $("<input type='checkbox' class='mid-ipt f-l'>");
                            var data = [];
                            data.push(value.cartId);
                            data.push(value.goods.goodsId);
                            data.push(value.inventory.inventoryId);
                            data.push(value.goods.goodsName);
                            data.push(value.inventory.inventoryName);
                            data.push(value.cartCount);
                            var $div3 = $("<div class='mid-font f-l' style='margin-left: 90px;height: 100px;width: 280px;margin-right: 5px'></div>");
                            var div3_a_href = "http://localhost:8080/goods/goods?goodsId="+ value.goods.goodsId;
                            var $div3_a = $("<a>"+value.goods.goodsName+"</a>");
                            $div3_a.attr("href",div3_a_href);
                            $div3.append($div3_a);
                            var $div4 = $("<div class='mid-guige f-l'></div>");
                            var $div4_P = $("<p></p>");
                            var div4_P_val = "规格："+value.inventory.inventoryName;
                            $div4_P.text(div4_P_val);
                            $div4.append($div4_P);
                            var $div5 = $("<div class='mid-sl f-l'></div>");
                            var $div5_a1 = $("<a class='sl-left'>-</a>");
                            var $div5_input = $("<input type='text'>");
                            $div5_input.attr("value",value.cartCount);
                            $div5_input.attr("readonly",true);
                            var $div5_a2 = $("<a class='sl-right'>+</a>");
                            $div5.append($div5_a1,$div5_input,$div5_a2);
                            $div5_a1.on("click",function () {
                                if (value.cartCount!==1)  {
                                    $.ajax({
                                        url: "http://localhost:8080/cart/subtractCount",
                                        method: "POST",
                                        data: {
                                            cartId:value.cartId,
                                            cartCount:value.cartCount,
                                            goodsId:value.goods.goodsId,
                                            inventoryId:value.inventory.inventoryId
                                        },
                                        dataType: "json",
                                        success: function () {
                                            window.location.href = "http://localhost:8080/cart/cart.html";
                                        }
                                    });
                                }
                            });
                            $div5_a2.on("click",function () {
                                $.ajax({
                                    url: "http://localhost:8080/cart/addCount",
                                    method: "POST",
                                    data: {
                                        cartId:value.cartId,
                                        cartCount:value.cartCount,
                                        goodsId:value.goods.goodsId,
                                        inventoryId:value.inventory.inventoryId
                                    },
                                    dataType: "json",
                                    success: function () {
                                        window.location.href = "http://localhost:8080/cart/cart.html";
                                    }
                                });
                            });
                            var $p1 = $("<p class='mid-dj f-l' style='width: 61.875px'></p>");
                            var p1_val;
                            //是vip
                            if (result.user.userVip=="1"){
                                p1_val = "￥"+ value.goods.goodsVipPrice;
                                data.push(value.goods.goodsVipPrice);
                            }else{
                                p1_val = "￥"+ value.goods.goodsPrice;
                                data.push(value.goods.goodsPrice);
                            }
                            $p1.text(p1_val);
                            var $p2 = $("<p class='mid-dj f-l' style='width: 61.875px'></p>");
                            var p2_val;
                            if (result.user.userVip=="1") {
                                p2_val = "￥"+ value.goods.goodsVipPrice*value.cartCount;
                            }else{
                                p2_val = "￥"+ value.goods.goodsPrice*value.cartCount;
                            }
                            $p2.text(p2_val);
                            var $div6 = $("<div class='mid-chaozuo f-l'></div>");
                            var $div6_a1 = $("<a href='#'>移入收藏夹</a>");
                            var $div6_a2 = $("<a href='#'>删除</a>");
                            $div6_a1.on("click",function () {
                                if (confirm("忍心删除吗？")) {
                                    $.ajax({
                                        url: "http://localhost:8080/cart/deleteCartinsertGoodscollert",
                                        method: "POST",
                                        data: {
                                            cartId:value.cartId,
                                            goodsId:value.goods.goodsId
                                        },
                                        dataType: "json",
                                        success: function (result) {
                                            if (result.result){
                                                alert(result.data);
                                                window.location.href = "http://localhost:8080/cart/cart.html";
                                            } else{
                                                alert(result.data);
                                                window.location.href = "http://localhost:8080/user/login.html";
                                            }
                                        }
                                    });
                                }
                            });
                            $div6_a2.on("click",function () {
                                if (confirm("忍心删除吗？")) {
                                    $.ajax({
                                        url: "http://localhost:8080/cart/deleteCart",
                                        method: "POST",
                                        data: {
                                            cartId:value.cartId,
                                            goodsId:value.goods.goodsId,
                                            inventoryId:value.inventory.inventoryId
                                        },
                                        dataType: "json",
                                        success: function () {
                                            window.location.href = "http://localhost:8080/cart/cart.html";
                                        }
                                    });
                                }
                            });
                            $input1.attr("data",data);
                            $div6.append($div6_a1,$div6_a2);
                            var $div7 = $("<div style='clear:both;'></div>");
                            $div2.append($input1,$div3,$div4,$div5,$p1,$p2,$div6,$div7);
                            $div1.append($div2);
                            $nav.append($div1);
                        });
                    } else{//未登录状态
                        $.each(result.cartList,function (index,value) {
                            var $div1 = $("<div class='cart-con-info'></div>");
                            var $div2 = $("<div class='info-mid'></div>");
                            var $input1 = $("<input type='checkbox' class='mid-ipt f-l'>");
                            var data = [];
                            data.push(value.cartId);
                            data.push(value.goods.goodsId);
                            data.push(value.inventory.inventoryId);
                            $input1.attr("data",data);
                            var $div3 = $("<div class='mid-font f-l' style='margin-left: 90px;height: 100px;width: 280px;margin-right: 5px'></div>");
                            var div3_a_href = "http://localhost:8080/goods/goods?goodsId="+ value.goods.goodsId;
                            var $div3_a = $("<a>"+value.goods.goodsName+"</a>");
                            $div3_a.attr("href",div3_a_href);
                            $div3.append($div3_a);
                            var $div4 = $("<div class='mid-guige f-l'></div>");
                            var $div4_P = $("<p></p>");
                            var div4_P_val = "规格："+value.inventory.inventoryName;
                            $div4_P.text(div4_P_val);
                            $div4.append($div4_P);
                            var $div5 = $("<div class='mid-sl f-l'></div>");
                            var $div5_a1 = $("<a class='sl-left'>-</a>");
                            var $div5_input = $("<input type='text'>");
                            $div5_input.attr("value",value.cartCount);
                            $div5_input.attr("readonly",true);
                            var $div5_a2 = $("<a class='sl-right'>+</a>");
                            $div5_a1.on("click",function () {
                               if (value.cartCount!==1)  {
                                   $.ajax({
                                       url: "http://localhost:8080/cart/subtractCount",
                                       method: "POST",
                                       data: {
                                           cartId:value.cartId,
                                           cartCount:value.cartCount,
                                           goodsId:value.goods.goodsId,
                                           inventoryId:value.inventory.inventoryId
                                       },
                                       dataType: "json",
                                       success: function () {
                                           window.location.href = "http://localhost:8080/cart/cart.html";
                                       }
                                   });
                               }
                            });
                            $div5_a2.on("click",function () {
                                $.ajax({
                                    url: "http://localhost:8080/cart/addCount",
                                    method: "POST",
                                    data: {
                                        cartId:value.cartId,
                                        cartCount:value.cartCount,
                                        goodsId:value.goods.goodsId,
                                        inventoryId:value.inventory.inventoryId
                                    },
                                    dataType: "json",
                                    success: function () {
                                        window.location.href = "http://localhost:8080/cart/cart.html";
                                    }
                                });
                            });
                            $div5.append($div5_a1,$div5_input,$div5_a2);
                            var $p1 = $("<p class='mid-dj f-l' style='width: 61.875px'></p>");
                            var p1_val = "￥"+ value.goods.goodsPrice;
                            $p1.text(p1_val);
                            var $p2 = $("<p class='mid-dj f-l' style='width: 61.875px'></p>");
                            var p2_val = "￥"+ value.goods.goodsPrice*value.cartCount;
                            $p2.text(p2_val);
                            var $div6 = $("<div class='mid-chaozuo f-l'></div>");
                            var $div6_a1 = $("<a href='#'>移入收藏夹</a>");
                            var $div6_a2 = $("<a href='#'>删除</a>");
                            $div6_a1.on("click",function () {
                                if (confirm("忍心删除吗？")) {
                                    $.ajax({
                                        url: "http://localhost:8080/cart/deleteCartinsertGoodscollert",
                                        method: "POST",
                                        data: {
                                            cartId:value.cartId,
                                            goodsId:value.goods.goodsId
                                        },
                                        dataType: "json",
                                        success: function (result) {
                                            if (result.result){
                                                alert(result.data);
                                                window.location.href = "http://localhost:8080/cart/cart.html";
                                            } else{
                                                alert(result.data);
                                                window.location.href = "http://localhost:8080/user/login.html";
                                            }
                                        }
                                    });
                                }
                            });
                            $div6_a2.on("click",function () {
                                if (confirm("忍心删除吗？")) {
                                    $.ajax({
                                        url: "http://localhost:8080/cart/deleteCart",
                                        method: "POST",
                                        data: {
                                            cartId:value.cartId,
                                            goodsId:value.goods.goodsId,
                                            inventoryId:value.inventory.inventoryId
                                        },
                                        dataType: "json",
                                        success: function () {
                                            window.location.href = "http://localhost:8080/cart/cart.html";
                                        }
                                    });
                                }
                            });
                            $div6.append($div6_a1,$div6_a2);
                            var $div7 = $("<div style='clear:both;'></div>");
                            $div2.append($input1,$div3,$div4,$div5,$p1,$p2,$div6,$div7);
                            $div1.append($div2);
                            $nav.append($div1);

                        });
                    }
                }
                //批量删除
                var $deleteCart = $("#deleteCart");
                $deleteCart.on("click",function () {

                });
            }
        });

        //删除按钮事件
        var $deleteCart = $("#deleteCart");
        $deleteCart.on("click",function () {
            var data = [];
            $(".mid-ipt:checked").each(function () {
                data.push($(this).attr("data"));
            });
            if (data.length===0){
                alert("请先选择!");
            } else if(data.length===1){
                $.ajax({
                    url: "http://localhost:8080/cart/deleteCartone",
                    method: "POST",
                    data: {
                        data:data
                    },
                    dataType: "json",
                    success: function () {
                        window.location.href = "http://localhost:8080/cart/cart.html";
                    }
                });
            }else{
                $.ajax({
                    url: "http://localhost:8080/cart/deleteCartAll",
                    method: "POST",
                    data: {
                        data:data
                    },
                    dataType: "json",
                    success: function () {
                        window.location.href = "http://localhost:8080/cart/cart.html";
                    }
                });
            }
        });
        //加入收藏夹
        var $insertGoodscollectAll = $("#insertGoodscollectAll");
        $insertGoodscollectAll.on("click",function () {
            var data = [];
            $(".mid-ipt:checked").each(function () {
                data.push($(this).attr("data"));
            });
            if (data.length===0){
                alert("请先选择!");
            } else if(data.length===1){
                $.ajax({
                    url: "http://localhost:8080/cart/insertGoodscollectone",
                    method: "POST",
                    data: {
                        data:data
                    },
                    dataType: "json",
                    success: function (result) {
                        if (result.result) {
                            alert(result.data);
                            window.location.href = "http://localhost:8080/cart/cart.html";
                        }else{
                            alert(result.data);
                            window.location.href = "http://localhost:8080/user/login.html";
                        }
                    }
                });
            }else{
                $.ajax({
                    url: "http://localhost:8080/cart/insertGoodscollectAll",
                    method: "POST",
                    data: {
                        data:data
                    },
                    dataType: "json",
                    success: function (result) {
                        if (result.result) {
                            alert(result.data);
                            window.location.href = "http://localhost:8080/cart/cart.html";
                        }else{
                            alert(result.data);
                            window.location.href = "http://localhost:8080/user/login.html";
                        }
                    }
                });
            }
        });
        //确认订单
        var $confirmorder = $("#confirmorder");
        $confirmorder.on("click",function () {
            var data = [];
            $(".mid-ipt:checked").each(function () {
                data.push($(this).attr("data"));
            });
            if (data.length===0){
                alert("请先选择!");
            } else if (data.length===1){
                $.ajax({
                    url: "http://localhost:8080/order/confirmorderone",
                    method: "POST",
                    data: {
                        data:data
                    },
                    dataType: "json",
                    success: function (result) {
                        if (result) {
                            window.location.href = "http://localhost:8080/order/confirmOrder.html";
                        }else{
                            alert("未登录！");
                            window.location.href = "http://localhost:8080/user/login.html";
                        }
                    }
                });
            } else{
                $.ajax({
                    url: "http://localhost:8080/order/confirmorder",
                    method: "POST",
                    data: {
                        data:data
                    },
                    dataType: "json",
                    success: function (result) {
                        if (result) {
                            window.location.href = "http://localhost:8080/order/confirmOrder.html";
                        }else{
                            alert("未登录！");
                            window.location.href = "http://localhost:8080/user/login.html";
                        }
                    }
                });
            }
        });
        //搜索商品
        var $goodsName = $("#goodsName");
        var $selectGoods = $("#selectGoods");
        $selectGoods.on("click",function () {
            if ($goodsName.val()===""){
                alert("请输入需要搜索的内容！");
                $goodsName.focus();
            }else{
                $.ajax({
                    url: "http://localhost:8080/goods/selectgoods",
                    method: "POST",
                    data:{
                        goodsName:$goodsName.val()
                    },
                    dataType: "json",
                    success: function () {
                        window.location.href = "http://localhost:8080/goods/goodsPaging.html";
                    }
                });
            }
        });
    })
</script>
</body>
</html>
