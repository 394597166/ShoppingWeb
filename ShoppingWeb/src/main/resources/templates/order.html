<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>我的订单</title>
<link rel="stylesheet" type="text/css" href="../static/css/style.css" />
<link rel="stylesheet" type="text/css" href="../static/css/shopping-mall-index.css" />
<script type="text/javascript" src="../static/js/jquery.js"></script>
<script type="text/javascript" src="../static/js/zhonglin.js"></script>
</head>

<body style="position:relative;">

<!--top 开始-->
<div class="top">
	<div class="top-con w1200">
		<p class="t-con-l f-l">您好，欢迎来到宅客微购</p>
		<ul class="t-con-r f-r">
			<li><a href="http://localhost:8080/user/personalCenter.html">我 (个人中心)</a></li>
			<li><a href="http://localhost:8080/cart/cart.html">我的购物车</a></li>
			<li><a href="http://localhost:8080/order/order.html">我的订单</a></li>
			<li class="erweima">
				<a href="#">扫描二维码</a>
				<div class="ewm-tu">
					<a href="#"><img src="../static/images/erweima-tu.jpg" /></a>
				</div>
			</li>
			<li><a href="http://localhost:8080/user/logout">退出</a></li>
			<div style="clear:both;"></div>
		</ul>
		<div style="clear:both;"></div>
	</div>
</div>

<!--logo search 开始-->
<div class="hd-info1 w1200">
	<div class="logo f-l">
		<h1><a href="http://localhost:8080/index.html" title="宅客微购"><img src="../static/images/logo.jpg" /></a></h1>
	</div>
	<div class="dianji f-r">
		<div class="btn1">
			<a href="http://localhost:8080/user/register.html"><button class="btn1-l">注册</button></a>
			<a href="http://localhost:8080/user/login.html"><button class="btn1-r">登录</button></a>
			<div style="clear:both;"></div>
		</div>
		<a href="http://localhost:8080/admin/adminlogin.html"><button class="btn2">商家入口    ></button></a>
	</div>
	<div class="search f-r">
		<ul class="sp">
			<li class="current" ss-search="sp"><a href="JavaScript:;">商品</a></li>
			<div style="clear:both;"></div>
		</ul>
		<div class="srh">
			<div class="ipt f-l">
				<input id="goodsName" type="text" placeholder="搜索商品..." ss-search-show="sp" />
			</div>
			<button id="selectGoods" class="f-r">搜 索</button>
			<div style="clear:both;"></div>
		</div>
	</div>
	<div style="clear:both;"></div>
</div>
    
    <!--nav 开始-->
    <div style="border-bottom:2px solid #F09E0B;">
    	<div class="nav w1200">
    	<a href="JavaScript:;" class="sp-kj" kj="">
        	商品分类快捷
        </a>
			<div id="category" class="kj-show2 none" kj-sh="">

			</div>
			<ul id="category_li">

			</ul>
        <div style="clear:both;"></div>
    </div>
    </div>
    
    <!--内容开始-->
    <div class="personal w1200">
    	<div class="personal-left f-l">
        	<div class="personal-l-tit">
            	<h3>个人中心</h3>
            </div>
            <ul>
				<li class="per-li2"><a href="http://localhost:8080/user/personalCenter.html">个人资料<span>></span></a></li>
				<li class="per-li1"><a href="http://localhost:8080/user/updateMail.html">邮箱设置<span>></span></a></li>
				<li class="per-li8"><a href="http://localhost:8080/user/updatePassword.html">密码设置<span>></span></a></li>
				<li class="per-li3"><a href="http://localhost:8080/order/order.html">我的订单<span>></span></a></li>
				<li class="per-li4"><a href="http://localhost:8080/user/balance.html">余额<span>></span></a></li>
				<li class="per-li5"><a href="http://localhost:8080/cart/cart.html">购物车<span>></span></a></li>
				<li class="per-li6"><a href="http://localhost:8080/user/address.html">管理收货地址<span>></span></a></li>
				<li class="per-li9"><a href="http://localhost:8080/user/userCoupon.html">优惠券<span>></span></a></li>
				<li class="per-li7"><a href="http://localhost:8080/user/usergoodscollect.html">商品收藏<span>></span></a></li>
            </ul>
        </div>
    	<div class="order-right f-r">
        	<div class="order-hd">
                <div class="ord-dai f-l">
                	<p>
						<a href="#" style="margin-right: 20px;width: 108px;margin-left: 10px" id="userorderListPayment">待支付</a>
						<a href="#" style="margin-right: 20px;width: 108px" id="userorderListSendgoods">待发货</a>
						<a href="#" style="margin-right: 20px;width: 108px" id="userorderListReceivinggoods">待收货<span></span></a>
						<a href="#" style="margin-right: 20px;width: 108px" id="userorderListEvaluate">待评价<span></span></a>
						<a href="#" style="margin-right: 20px;width: 108px" id="userorderListFinish">已完成<span></span></a>
						<a href="#" style="margin-right: 20px;width: 108px" id="userorderListCancel">已取消<span></span></a>
						<a href="#" style="margin-right: 20px;width: 108px" id="userorderListRepair">返修中<span></span></a>
						<a href="#" style="width: 108px" id="userorderListReturn">退货中<span></span></a>
					</p>
                </div>
                <div style="clear:both;"></div>
            </div>
            <div class="order-md">
            	<div class="md-tit">
                	<h3>我的订单</h3>
                </div>
				<div id="order-md">

				</div>
			</div>
		</div>
        <div style="clear:both;"></div>
    </div>

<!--底部服务-->
<div class="ft-service">
	<div class="w1200">
		<div class="sv-con-l2 f-l">
			<dl>
				<dt><a>新手上路</a></dt>
				<dd>
					<a href="http://localhost:8080/other/service.html">服务协议</a>
					<a href="http://localhost:8080/other/onlinePayment.html">在线支付</a>
				</dd>
			</dl>
			<dl>
				<dt><a>配送方式</a></dt>
				<dd>
					<a href="http://localhost:8080/other/distribution.html">配送费标准</a>
				</dd>
			</dl>
			<dl>
				<dt><a>购物指南</a></dt>
				<dd>
					<a href="http://localhost:8080/other/FAQ.html">购物常见问题</a>
					<a href="http://localhost:8080/other/shoppingProcess.html">购物流程</a>
				</dd>
			</dl>
			<dl>
				<dt><a>售后服务</a></dt>
				<dd>
					<a href="http://localhost:8080/other/exchanged.html">退换货政策总则</a>
					<a href="http://localhost:8080/other/exchanged2.html">自营商品退换货细则</a>
				</dd>
			</dl>
			<dl>
				<dt><a>关于我们</a></dt>
				<dd>
					<a href="http://localhost:8080/other/about.html">关于我们</a>
				</dd>
			</dl>
			<div style="clear:both;"></div>
		</div>
		<div class="sv-con-r2 f-r">
			<p class="sv-r-tle">151-6264-6839</p>
			<p>周一至周五9:00-16:00</p>
			<p>（仅收市话费）</p>
			<a href="http://wpa.qq.com/msgrd?v=3&uin=394597166&site=qq&menu=yes" target="_blank" class="zxkf">24小时在线客服</a>
		</div>
		<div style="clear:both;"></div>
	</div>
</div>
    

<script type="text/javascript">
	$(function () {
	    //获得所有订单数据
	    var $order_md = $("#order-md");
	    //待支付
		var $userorderListPayment = $("#userorderListPayment");
		//待发货
        var $userorderListSendgoods = $("#userorderListSendgoods");
        //待收货
		var $userorderListReceivinggoods = $("#userorderListReceivinggoods");
        //待评价
        var $userorderListEvaluate = $("#userorderListEvaluate");
        //已完成
        var $userorderListFinish = $("#userorderListFinish");
        //已取消
        var $userorderListCancel = $("#userorderListCancel");
        //返修中
        var $userorderListRepair = $("#userorderListRepair");
        //退货中
        var $userorderListReturn = $("#userorderListReturn");
        $.ajax({
            url: "http://localhost:8080/order/selectAllorder",
            method: "POST",
            dataType: "json",
            success: function (result) {
                if (result.result) {
                    order(result.userorderList);
                    //待支付
					var Payment_span = $("<span>"+result.userorderListPayment.length+"</span>");
                    $userorderListPayment.append(Payment_span);
                    $userorderListPayment.on("click",function () {
                        order(result.userorderListPayment);
                    });
                    //待发货
                    var Sendgoods_span = $("<span>"+result.userorderListSendgoods.length+"</span>");
                    $userorderListSendgoods.append(Sendgoods_span);
                    $userorderListSendgoods.on("click",function () {
                        order(result.userorderListSendgoods);
                    });
                    // 待收货
                    var Receivinggoods_span = $("<span>"+result.userorderListReceivinggoods.length+"</span>");
                    $userorderListReceivinggoods.append(Receivinggoods_span);
                    $userorderListReceivinggoods.on("click",function () {
                        order(result.userorderListReceivinggoods);
                    });
                    //待评价
                    var Evaluate_span = $("<span>"+result.userorderListEvaluate.length+"</span>");
                    $userorderListEvaluate.append(Evaluate_span);
                    $userorderListEvaluate.on("click",function () {
                        order(result.userorderListEvaluate);
                    });
                    //已完成
                    var Finish_span = $("<span>"+result.userorderListFinish.length+"</span>");
                    $userorderListFinish.append(Finish_span);
                    $userorderListFinish.on("click",function () {
                        order(result.userorderListFinish);
                    });
                    // 已取消
                    var Cancel_span = $("<span>"+result.userorderListCancel.length+"</span>");
                    $userorderListCancel.append(Cancel_span);
                    $userorderListCancel.on("click",function () {
                        order(result.userorderListCancel);
                    });
                    //返修中
                    var Repair_span = $("<span>"+result.userorderListRepair.length+"</span>");
                    $userorderListRepair.append(Repair_span);
                    $userorderListRepair.on("click",function () {
                        order(result.userorderListRepair);
                    });
                    // 退货中
                    var Return_span = $("<span>"+result.userorderListReturn.length+"</span>");
                    $userorderListReturn.append(Return_span);
                    $userorderListReturn.on("click",function () {
                        order(result.userorderListReturn);
                    });

				}else{
                    alert(result.data);
                    window.location.href = "http://localhost:8080/user/login.html";
				}
            }
        });
        //公用方法
        function order(order) {
            $order_md.empty();
            $.each(order,function (index,userorder) {
                //订单盒子
                var $div1 = $("<div class='md-info'></div>");
                //订单基本信息
                var $div2 = $("<div class='md-hd'></div>");
                var $div2_p1 = $("<p class='md-p1'>"+userorder.userorderTime+"</p>");
                var $div2_p2 = $("<a href='#' class='md-p2' style='margin-right: 200px'>订单号：</a>");
                var $div2_p2_span = $("<span>"+userorder.userorderId+"</span>");
                var $div2_p3 = $("<p class='md-p3'>订单状态：</p>");
                var $div2_p3_span = $("<span>"+userorder.userorderState+"</span>");
                var $div2_div = $("<div style='clear: both'></div>");
                $div2_p2.append($div2_p2_span);
                $div2_p3.append($div2_p3_span);
                $div2.append($div2_p1,$div2_p2,$div2_p3,$div2_div);
                //商品信息
                var $div3 = $("<div class='dai-con'></div>");
                var $dl = $("<dl class='dl1'></dl>");
                var data = [];
                $.each(userorder.userorderitemList,function (index,userorderitem) {
                    var item = userorderitem.goodsId+","+userorderitem.inventoryId+","+userorderitem.userorderitemCount;
                    data.push(item);
                    var $dd = $("<dd style='margin-left: 10px'></dd>");
                    var $dd_p = $("<a><p>"+userorderitem.goodsName+"</p></a>");
                    var href = "http://localhost:8080/goods/goods?goodsId="+ userorderitem.goodsId;
                    $dd_p.attr("href",href);
                    var $dd_span = $("<span>X<span>"+userorderitem.userorderitemCount+"</span></span>");
                    $dd.append($dd_p,$dd_span);
                    $dl.append($dd);
                });
                var $dl_div = $("<div style='clear: both'></div>");
                $dl.append($dl_div);
                //操作
                var $div4 = $("<div class='dai-right f-l'></div>");
                var $div4_p1 = $("<p class='d-r-p2'style='margin-top: 20px'>"+userorder.addressAlias+"</p>");
                //隐藏手机号
                var temp = userorder.addressPhone;
                var temp_1 = temp.split('');
                for (var i = 3;i < 7;i++){
                    temp_1[i] = "*";
                }
                temp = temp_1.join('');
                var address =userorder.addressName+"\n"+userorder.addressDistrict+userorder.addressDetailed+"\n"+temp;
                $div4_p1.attr("title",address);
                var $div4_p2 = $("<p class='d-r-p3'>总额：</p>");
                var $div4_p2_span = $("<span>"+(userorder.userorderPrice-userorder.couponSubtract)+"</span>");
                var $div4_p3 = $("<p class='d-r-p4'></p>");
                var $div4_p3_a1 = $("<a href='#'>订单详情</a><br>");
                var $div4_p3_a2 = $("<a href='#'>再次购买</a><br>");
                $div4_p3_a2.on("click",function () {
					if (data.length<=1){
                        $.ajax({
                            url: "http://localhost:8080/cart/insertCartone",
                            method: "POST",
                            data: {
                                data:data
                            },
                            dataType: "json",
                            success: function (result) {
                                if (result.result){
                                    window.location.href = "http://localhost:8080/cart/cart.html";
                                }else{
                                    alert(result.data);
                                    window.location.href = "http://localhost:8080/user/login.html";
                                }
                            }
                        });
					} else{
                        $.ajax({
                            url: "http://localhost:8080/cart/insertCartAll",
                            method: "POST",
                            data: {
                                data:data
                            },
                            dataType: "json",
                            success: function (result) {
                                if (result.result){
                                    window.location.href = "http://localhost:8080/cart/cart.html";
                                }else{
                                    alert(result.data);
                                    window.location.href = "http://localhost:8080/user/login.html";
                                }
                            }
                        });
					}
                });
                if (userorder.userorderState==="待支付"){
                    var $div4_p3_a3 = $("<a href='#'>去支付</a><br>");
                    $div4_p3_a3.on("click",function () {
                        $.ajax({
                            url: "http://localhost:8080/order/userorderId",
                            method: "POST",
                            data: {
                                userorderId:userorder.userorderId
                            },
                            dataType: "json",
                            success: function (result) {
                                if (result.result){
                                    window.location.href = "http://localhost:8080/order/userPay.html";
                                }else{
                                    alert(result.data);
                                    window.location.href = "http://localhost:8080/user/login.html";
                                }
                            }
                        });
                    });
                    var $div4_p3_a4 = $("<a href='#'>取消</a><br>");
                    $div4_p3_a4.on("click",function () {
                        if (confirm("确定取消订单吗？")){
                            $.ajax({
                                url: "http://localhost:8080/order/cancelOrder",
                                method: "POST",
                                data: {
                                    userorderId:userorder.userorderId
                                },
                                dataType: "json",
                                success: function (result) {
                                    if (result.result){
                                        window.location.href = "http://localhost:8080/order/order.html";
                                    }else{
                                        alert(result.data);
                                        window.location.href = "http://localhost:8080/user/login.html";
                                    }
                                }
                            });
						}
                    });
                }
                if (userorder.userorderState==="待收货"){
                    var $div4_p3_a5 = $("<a href='#'>确认收货</a><br>");
                    $div4_p3_a5.on("click",function () {
						if (confirm("确认收货吗？")) {
                            $.ajax({
                                url: "http://localhost:8080/order/confirmReceipt",
                                method: "POST",
                                data: {
                                    userorderId:userorder.userorderId
                                },
                                dataType: "json",
                                success: function (result) {
                                    if (result.result){
                                        window.location.href = "http://localhost:8080/order/order.html";
                                    }else{
                                        alert(result.data);
                                        window.location.href = "http://localhost:8080/user/login.html";
                                    }
                                }
                            });
						}
                    });
				}
                if (userorder.userorderState==="待评价"){
                    var $div4_p3_a6 = $("<a href='#'>评价</a><br>");
                    $div4_p3_a6.on("click",function () {
                    });
                }
                $div4_p2.append($div4_p2_span);
                $div4_p3.append($div4_p3_a1,$div4_p3_a2,$div4_p3_a3,$div4_p3_a4,$div4_p3_a5,$div4_p3_a6);
                $div4.append($div4_p1,$div4_p2,$div4_p3);
                var $div3_div = $("<div style='clear: both'></div>");
                $div3.append($dl,$div4,$div3_div);
                $div1.append($div2,$div3);
                $order_md.append($div1);
            })
        }
        //搜索商品
        var $goodsName = $("#goodsName");
        var $selectGoods = $("#selectGoods");
        $selectGoods.on("click",function () {
            if ($goodsName.val()===""){
                alert("请输入需要搜索的内容！");
                $goodsName.focus();
            }else{
                $.ajax({
                    url: "http://localhost:8080/goods/selectgoods",
                    method: "POST",
                    data:{
                        goodsName:$goodsName.val()
                    },
                    dataType: "json",
                    success: function () {
                        window.location.href = "http://localhost:8080/goods/goodsPaging.html";
                    }
                });
            }
        });
        // 商品分类快捷
        $.ajax({
            url: "http://localhost:8080/category",
            method: "POST",
            dataType: "json",
            success: function (result) {
                //商品分类标签
                var $category = $("#category");
                var $category_li = $("#category_li");
                //循环遍历result
                $.each(result,function (index, value) {
                    //分类盒子
                    var $div_1 = $("<div></div>");
                    $div_1.addClass("kj-info1");
                    //分类标题
                    var $dl_1 = $("<dl></dl>");
                    $dl_1.addClass("kj-dl1");
                    //标题
                    var $dt_1 = $("<dt><a href='#'>"+value.categoryName+"</a></dt>");
                    $dt_1.on("click",function () {
                        $.ajax({
                            url: "http://localhost:8080/goods/selectgoodsAndCategoryId",
                            method: "POST",
                            data:{
                                categoryId:value.categoryId
                            },
                            dataType: "json",
                            success: function () {
                                window.location.href = "http://localhost:8080/goods/goodsPaging.html";
                            }
                        });
                    });
                    var $li = $("<li><a href='#'>"+value.categoryName+"</a></li>");
                    $li.on("click",function () {
                        $.ajax({
                            url: "http://localhost:8080/goods/selectgoodsAndCategoryId",
                            method: "POST",
                            data:{
                                categoryId:value.categoryId
                            },
                            dataType: "json",
                            success: function () {
                                window.location.href = "http://localhost:8080/goods/goodsPaging.html";
                            }
                        });
                    });
                    var text = "";
                    var i = 0;
                    $.each(value.subclassificationList,function (index2,value2) {
                        i++;
                        if(i%3==0){
                            text = text + value2.subclassificationName+"<br/>";
                        }else{
                            text = text + value2.subclassificationName+"/";
                        }
                    });
                    //内容
                    var $dd_1 = $("<dd>"+text+"</dd>");
                    $dl_1.append($dt_1,$dd_1);
                    $div_1.append($dl_1);
                    //子分类
                    var $div_2 = $("<div></div>");
                    $div_2.addClass("kj-if-show");
                    $.each(value.subclassificationList,function (index3,value3) {
                        var $dl_2 = $("<dl></dl>");
                        var $dt_2 = $("<dt><a href='#'>"+value3.subclassificationName+"</a></dt>");
                        $dt_2.on("click",function () {
                            $.ajax({
                                url: "http://localhost:8080/goods/selectgoodsAndSubclassificationId",
                                method: "POST",
                                data:{
                                    subclassificationId:value3.subclassificationId
                                },
                                dataType: "json",
                                success: function () {
                                    window.location.href = "http://localhost:8080/goods/goodsPaging.html";
                                }
                            });
                        });
                        var $dd_2 = $("<dd></dd>");
                        //次分类
                        $.each(value3.subseriesList,function (index4,value4) {
                            var $a = $("<a href='#'>"+value4.subseriesName+"</a>");
                            $a.on("click",function () {
                                $.ajax({
                                    url: "http://localhost:8080/goods/selectgoodsAndSubseriesId",
                                    method: "POST",
                                    data:{
                                        subseriesId:value4.subseriesId
                                    },
                                    dataType: "json",
                                    success: function () {
                                        window.location.href = "http://localhost:8080/goods/goodsPaging.html";
                                    }
                                });
                            });
                            $dd_2.append($a);
                        });
                        var $div_3 = $("<div style='clear: both'></div>");
                        $dl_2.append($dt_2,$dd_2,$div_3);
                        $div_2.append($dl_2);
                    });
                    $div_1.append($div_2);
                    //鼠标移入事件
                    $div_1.on("mouseover",function () {
                        $div_1.removeClass();
                        $div_1.addClass("kj-info1 hover-show-bg");
                        $div_2.css("display","block");
                    });
                    //鼠标移出事件
                    $div_1.on("mouseout",function () {
                        $div_1.removeClass();
                        $div_1.addClass("kj-info1");
                        $div_2.css("display","none");
                    });
                    $category.append($div_1);
                    $category_li.append($li);
                });
                var $div_4 = $("<div style='clear: both'></div>")
                $category_li.append($div_4);
            }
        });
    });
</script>
</body>
</html>
